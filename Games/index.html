---
title: Game
layout: game
---

<span>
	<img id="thumbnail">
	<table id="Parameters">
		<tr name="NoPlayers" class="hidden">
			<td class="label">No.</td>
			<td><input class="spinner" name="NoPlayers"></td>
		</tr>
		<tr>
			<td colspan="2">
				<button onclick="Display('Setup')">Setup</button>
				<button onclick="Display('EndGame')">End Game</Button>
			</td>
		</tr>
	</table>
</span>

<div id="GameInfo">
</div>




<script>
var gamedata;
var url = new URL(window.location.href);
var BGGID = url.searchParams.get("bggid");




function myStringInterpolation(tpl,args) {
	var keys = Object.keys(args)
	,fn = new Function(...keys,'return `' + tpl.replace(/`/g, '\\`') + '`');
	return fn(...keys.map(x => args[x]));
};




function Display(display) {
	var displaygamedata;
	var html = "";
	var NoPlayers = $("input[name='NoPlayers']").spinner("value");

	// Get relevant data
	switch(display) {
		case "EndGame":
			displaygamedata = $(gamedata).find("Base EndGame");
			break
		case "Setup":
			displaygamedata = $(gamedata).find("Base Setup");
			break
	}

	// Alert and return if No. Players is NULL
	if (
		$("#Parameters tr[name='NoPlayers']").css("visibility") == "visible"
		&& NoPlayers == null
	) {
		alert("Please set number of " + $(gamedata).find("Strings Players_Lower").text());
		return
	}

	// Heading 1
	html += "<h1>"
	switch(display) {
		case "EndGame":
			html += "End Game";
			break
		case "Setup":
			html += "Setup";
			break
	}
	html += ((NoPlayers != null) ? " - " + NoPlayers + " " + $(gamedata).find("Strings Players_Capitalise").text(): "")
	+ "</h1>";

	// Add information
	switch(display) {
		case "EndGame":
			// End Game Triggers
			if ($(displaygamedata).find("Trigger Item Text").first().text() != "") {
				var item = $(displaygamedata).find("Trigger Item");
				html += "<h2>Trigger</h2><ul>";
				$(item).each(function(){
					var subs = {
						Players: $(this).find("Players[number='" + NoPlayers + "']").text()
					};
					html += "<li>" + myStringInterpolation($(this).find("Text").text(),subs) + "</li>";
				});
				html += "</ul>";
			}

			// End Game Scoring
			if ($(displaygamedata).find("Scoring Item Text").text() != "") {
				var item = $(displaygamedata).find("Scoring Item");
				html += "<h2>Scoring</h2><ul>";
				$(item).each(function(){
					var subs = {
						Players: $(this).find("Players[number='" + NoPlayers + "']").text()
					};
					html += "<li>" + myStringInterpolation($(this).find("Text").text(),subs) + "</li>";
				});
				html += "</ul>";
			}

			break

		case "Setup":
			// Setup
			var item = $(displaygamedata).find("Item");
			html += "<ul>";
			$(item).each(function(){
				var subs = {
					Players: $(this).find("Players[number='" + NoPlayers + "']").text()
				};
				html += "<li>" + myStringInterpolation($(this).find("Text").text(),subs) + "</li>";
			});
			html += "</ul>";
			break
	}

	// Put HTML into page
	$("#GameInfo").html(html);
}




$(document).ready(function(){
	//Get BGGAPI Data
	$.get(
		"{{ site.bggapi-thing }}" + BGGID
		,function(data){
			var item = $(data).find("items item");

			var name = $(item).find("name[type='primary']").attr("value");
			$("head title").html(name + " - {{ site.title }}");
			$("section#title h1").html(name);

			var img = $(item).find("thumbnail").text();
			$("img#thumbnail").attr("src",img);
		}
	);

	// Get Internal Data
	$.get(
		"{{ '/Games/' | relative_url }}" + BGGID + ".xml"
		,function(data){
			gamedata = $(data).find("Game");

			// Unhide player number chooser if appropriate
			var MinPlayers = $(gamedata).find("Base Players MinPlayers").text();
			var MaxPlayers = $(gamedata).find("Base Players MaxPlayers").text();
			var DefaultPlayers = $(gamedata).find("Base Players Default").text();
			var TextPlayers = $(gamedata).find("Strings Players_Capitalise").text();

			if (MinPlayers != MaxPlayers) {
				$("#Parameters tr[name='NoPlayers'] .label").html("No. " + TextPlayers);
				$("input[name='NoPlayers']").spinner({
					min: MinPlayers
					,max: MaxPlayers
				});
				$("input[name='NoPlayers']").spinner("value",DefaultPlayers);
				$("#Parameters tr[name='NoPlayers']").css("visibility","visible");
			}
		}
	);

	$("button").button();
});
</script>
